<!DOCTYPE html>
<html lang="en">
<!-- Head section remains unchanged -->
<head>
    <!-- All head content remains the same -->
    <!-- ... -->
</head>
<body>
    <!-- All body content before the feedback form remains the same -->
    
    <!-- Feedback Section with updated form to include email input -->
    <div class="feedback-container">
        <button id="feedback-button" class="feedback-button">Provide Feedback</button>
        <div id="feedback-form" class="feedback-form">
            <form id="feedback-form-element">
                <p>We'd love to hear your thoughts on CompMax™:</p>
                <!-- Add email input field -->
                <input type="email" id="feedback-email" name="email" placeholder="Your email address (so we can respond)" required style="width: 100%; margin-bottom: 10px; padding: 8px; border: 1px solid var(--gray-300); border-radius: 4px;">
                <textarea id="feedback-message" name="feedback" placeholder="Enter your feedback here..." required></textarea>
                <button type="submit" id="send-feedback">Send Feedback</button>
                <div id="feedback-response" class="feedback-response"></div>
            </form>
        </div>
    </div>
    
    <!-- The rest of the body content remains the same until the feedback JavaScript -->
    
    <!-- Updated Feedback JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const feedbackButton = document.getElementById('feedback-button');
            const feedbackForm = document.getElementById('feedback-form');
            const feedbackFormElement = document.getElementById('feedback-form-element');
            const feedbackResponse = document.getElementById('feedback-response');
            
            // Toggle feedback form
            feedbackButton.addEventListener('click', function() {
                feedbackForm.style.display = feedbackForm.style.display === 'block' ? 'none' : 'block';
                feedbackResponse.style.display = 'none';
                feedbackResponse.className = 'feedback-response';
            });
            
            // Handle form submission without redirecting
            feedbackFormElement.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const feedbackMessage = document.getElementById('feedback-message').value.trim();
                const senderEmail = document.getElementById('feedback-email').value.trim();
                
                if (!feedbackMessage) {
                    showFeedbackMessage('Please enter your feedback before sending.', 'error');
                    return;
                }
                
                if (!senderEmail) {
                    showFeedbackMessage('Please provide your email address.', 'error');
                    return;
                }
                
                // Show "sending" status
                showFeedbackMessage('Sending feedback...', 'pending');
                
                // Send feedback via EmailJS
                emailjs.send(CONFIG.emailjs.serviceId, CONFIG.emailjs.templateId, {
                    to_name: "Admin",
                    to_email: "maxwell.ian@gmail.com",
                    subject: "CompMax™ Feedback",
                    message: feedbackMessage,
                    from_name: "CompMax™ User",
                    reply_to: senderEmail,
                    sender_email: senderEmail,
                    time: new Date().toLocaleString()
                })
                .then(function(response) {
                    console.log('Feedback email sent successfully:', response.status, response.text);
                    showFeedbackMessage('Thank you for your feedback!', 'success');
                    
                    // Save the feedback to localStorage as a backup
                    const feedbacks = JSON.parse(localStorage.getItem('compmax-feedback') || '[]');
                    feedbacks.push({
                        message: feedbackMessage,
                        email: senderEmail,
                        timestamp: new Date().toISOString()
                    });
                    localStorage.setItem('compmax-feedback', JSON.stringify(feedbacks));
                    
                    // Reset the form
                    document.getElementById('feedback-message').value = '';
                    document.getElementById('feedback-email').value = '';
                    
                    // Auto-hide after 3 seconds
                    setTimeout(function() {
                        feedbackForm.style.display = 'none';
                    }, 3000);
                })
                .catch(function(error) {
                    console.error('Feedback email failed:', error);
                    showFeedbackMessage('Failed to send feedback. Please try again later.', 'error');
                });
            });
            
            function showFeedbackMessage(message, type) {
                feedbackResponse.textContent = message;
                feedbackResponse.style.display = 'block';
                
                if (type === 'success') {
                    feedbackResponse.className = 'feedback-response feedback-success';
                } else if (type === 'error') {
                    feedbackResponse.className = 'feedback-response feedback-error';
                } else {
                    feedbackResponse.className = 'feedback-response';
                    feedbackResponse.style.backgroundColor = '#f0f0f0';
                    feedbackResponse.style.color = '#666';
                }
            }
            
            // Email Share Button Functionality remains unchanged
            const emailButton = document.getElementById('email-share-button');
            const emailModal = document.getElementById('email-options-modal');
            const closeEmailModal = document.getElementById('close-email-options');
            
            // Toggle email options modal
            emailButton.addEventListener('click', function(e) {
                e.preventDefault();
                emailModal.style.display = 'flex';
            });
            
            // Close email options modal
            closeEmailModal.addEventListener('click', function() {
                emailModal.style.display = 'none';
            });
            
            // Close email modal when clicking outside the content
            emailModal.addEventListener('click', function(e) {
                if (e.target === emailModal) {
                    emailModal.style.display = 'none';
                }
            });
        });
    </script>

    <!-- Rest of the scripts remain unchanged -->
    <script>
        // Form Data Persistence Script remains the same
    </script>
</body>
</html>
