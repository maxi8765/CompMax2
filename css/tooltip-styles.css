/* 
 * tooltip-styles.css 
 * Styles for info icons and tooltips with link support
 */

/* Info Icon and Tooltip Styles */
.info-icon-container {
    display: inline-block;
    position: relative;
    margin-left: 8px;
    vertical-align: middle;
}

.info-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background-color: var(--primary);
    color: white;
    font-size: 12px;
    font-weight: bold;
    cursor: pointer;
    transition: background-color var(--transition-speed);
    user-select: none;
    -webkit-tap-highlight-color: transparent;
}

.info-icon:hover, 
.info-icon:focus {
    background-color: var(--primary-dark);
}
/* Updates for tooltip-styles.css to fix mobile icon size and positioning */

/* Mobile adjustments */
@media (max-width: 600px) {
    /* Fix for info icons - make them smaller and properly positioned */
    .info-icon-container {
        position: relative;
        z-index: 105;
        margin-left: 6px; /* Reduce margin */
        touch-action: manipulation;
        vertical-align: middle;
        display: inline-flex;
    }
    
    .info-icon {
        width: 20px; /* Smaller size */
        height: 20px; /* Smaller size */
        font-size: 12px; /* Smaller font */
        position: relative;
        z-index: 106;
        display: flex;
        align-items: center;
        justify-content: center;
        box-sizing: border-box; /* Ensure padding is included in width/height */
        padding: 0; /* Remove padding that might cause size issues */
        margin: 0; /* Remove margin that might cause positioning issues */
    }

    /* Make tooltip slightly offset to avoid covering labels */
    .tooltip {
        width: 85%;
        max-width: 300px;
        font-size: 0.85rem;
        position: fixed;
        top: 45%; /* Slightly higher to see more of the page */
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 12px;
        z-index: 1010;
        box-shadow: 0 4px 20px rgba(0,0,0,0.25);
    }
    
    /* Make close button more prominent */
    .tooltip-close {
        display: block;
        padding: 6px;
        font-size: 16px;
        right: 6px;
        top: 6px;
    }
    
    /* Ensure label text doesn't wrap awkwardly around icons */
    label {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        margin-bottom: 0.5rem;
    }
    
    /* Give label text some space before the icon */
    label .info-icon-container {
        margin-left: auto; /* Push to the right */
    }
}.tooltip {
    visibility: hidden;
    position: absolute;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    width: 250px;
    background-color: white;
    color: var(--dark);
    text-align: left;
    border-radius: 6px;
    padding: 10px;
    font-size: 0.75rem;
    line-height: 1.4;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.2s, visibility 0.2s;
    border: 1px solid var(--gray-300);
}

/* Arrow at the bottom of tooltip */
.tooltip::after {
    content: "";
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -8px;
    border-width: 8px;
    border-style: solid;
    border-color: white transparent transparent transparent;
}

/* Show tooltip on hover/focus of icon (desktop only) */
.info-icon:hover + .tooltip,
.info-icon:focus + .tooltip,
.tooltip:hover {
    visibility: visible;
    opacity: 1;
}

/* Alternative position for tooltips that might go off-screen */
.tooltip.tooltip-left {
    left: 0;
    transform: translateX(-10%);
}

.tooltip.tooltip-left::after {
    left: 15%;
}

.tooltip.tooltip-right {
    left: auto;
    right: 0;
    transform: translateX(10%);
}

.tooltip.tooltip-right::after {
    left: 85%;
}

/* Link styling within tooltips */
.tooltip a {
    color: var(--primary);
    text-decoration: none;
    font-weight: 600;
    display: inline-block;
    margin-top: 5px;
}

.tooltip a:hover, 
.tooltip a:focus {
    text-decoration: underline;
    color: var(--primary-dark);
}

/* Close button for mobile tooltips */
.tooltip-close {
    position: absolute;
    top: 5px;
    right: 5px;
    background: none;
    border: none;
    font-size: 16px;
    cursor: pointer;
    color: #666;
    padding: 5px;
    display: none;
}

/* Tooltip overlay (mobile) */
.tooltip-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 900;
}

/* Mobile adjustments */
@media (max-width: 600px) {
    /* Fix for info icons */
    .info-icon-container {
        position: relative;
        z-index: 5; /* Higher than surrounding elements */
        margin-left: 8px;
        touch-action: manipulation;
    }
    
    .info-icon {
        width: 24px;
        height: 24px;
        font-size: 14px;
        position: relative;
        z-index: 6;
        /* Create a larger but invisible touch target */
        box-sizing: content-box;
        border: 8px solid transparent;
        margin: -8px;
        touch-action: manipulation;
    }
    
    /* Fix for input field buffers interfering with touch */
    input[type="text"],
    input[type="email"],
    input[type="number"],
    input[type="date"] {
        /* Limit the touch target to the visible boundaries */
        touch-action: manipulation;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        margin: 0;
    }
    
    /* Ensure form labels don't have extra touch area */
    label {
        display: inline-block;
        position: relative;
        margin-bottom: 0.5rem;
        /* Prevent touch events from being captured beyond visible boundaries */
        overflow: visible;
        touch-action: manipulation;
    }
    
    /* Fix for radio button layout - reduce buffer area */
    .radio-label {
        display: flex;
        align-items: center;
        padding: 0;
        margin: 0;
        /* Create a more precise touch area */
        touch-action: manipulation;
    }
    
    /* Ensure input groups don't have extra padding */
    .input-group {
        position: relative;
        touch-action: manipulation;
    }
    
    /* Tooltip styles for mobile */
    .tooltip-close {
        display: block;
    }
    
    .tooltip {
        width: 90%;
        max-width: 320px;
        font-size: 0.8rem;
        position: fixed;
        top: 50%;
        left: 50%;
        bottom: auto;
        transform: translate(-50%, -50%);
        padding: 15px;
    }
    
    .tooltip::after {
        display: none;
    }
    
    .tooltip.tooltip-left,
    .tooltip.tooltip-right {
        left: 50%;
        right: auto;
        transform: translate(-50%, -50%);
    }
    
    .tooltip.tooltip-left::after,
    .tooltip.tooltip-right::after {
        display: none;
    }
    
    .tooltip a {
        padding: 10px 0;
        margin: 8px 0;
        display: inline-block;
    }
    /**
 * Info Icons Manager
 * Manages the help tooltip icons throughout the application
 */

// First IIFE: Label formatting to prevent icon overlap
(function() {
    // This function runs before the icon setup to adjust the labels
    function setupLabelFormatting() {
        // Find all labels
        const labels = document.querySelectorAll('label');
        
        // Process each label
        labels.forEach(label => {
            // Skip labels that have already been processed
            if (label.classList.contains('label-formatted')) return;
            
            // Add class to mark as processed
            label.classList.add('label-formatted');
            
            // Create a span to wrap the label text
            const labelText = label.textContent.trim();
            
            // Only if there is text to process
            if (labelText) {
                // Clear the current text
                label.textContent = '';
                
                // Create text wrapper
                const textSpan = document.createElement('span');
                textSpan.className = 'label-text';
                textSpan.textContent = labelText;
                
                // Add the text back in a span
                label.appendChild(textSpan);
            }
        });
    }
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            setupLabelFormatting();
        });
    } else {
        setupLabelFormatting();
    }
})();

// Second IIFE: Info icons functionality
(function() {
    // Define tooltip content for each field
    const tooltipContent = {
        'company-name': 'Enter your company or organization name as it should appear on the offer.',
        'sender-name': 'Your name as the representative making this offer.',
        'employer-email': 'Your email address for receiving notifications when the offer is accepted.',
        'offer-date': 'The official date of this compensation offer.',
        'position-title': 'The specific role or job title you are offering.',
        'employee-name': "The candidate's full name as it should appear on the formal offer.",
        'employee-email': "The candidate's email address where this offer will be sent.",
        'max-salary': 'The maximum salary amount you are willing to offer. The candidate can choose a lower amount in exchange for more equity. <a href="compensation-resources.html" target="_blank">View startup compensation resources</a>',
        'max-equity': 'The maximum equity percentage you are willing to offer. This will be available to the candidate if they choose a lower salary.',
        'max-shares': 'The maximum number of shares you are willing to offer. This will be available to the candidate if they choose a lower salary.',
        'equity-type-selection': 'Choose whether to offer equity as a percentage of the company or as a specific number of shares.',
        'salary-slider': 'Move the slider to adjust the balance between salary and equity. Moving left increases equity and decreases salary. Moving right increases salary and decreases equity.'
    };
    
    // Create overlay for mobile tooltips (once)
    let tooltipOverlay;
    
    // Keep track of active tooltip for mobile
    let activeTooltip = null;
    
    // Function to add info icons to all elements
    function addInfoIcons() {
        // Detect if we're on a mobile device
        const isMobile = window.matchMedia("(max-width: 600px)").matches;
        
        // Create a modal backdrop for mobile tooltips
        if (isMobile && !tooltipOverlay) {
            tooltipOverlay = document.createElement('div');
            tooltipOverlay.className = 'tooltip-overlay';
            document.body.appendChild(tooltipOverlay);
            
            // Close tooltip when clicking the overlay
            tooltipOverlay.addEventListener('click', function(e) {
                if (e) e.preventDefault(); // Prevent default touch behavior
                if (activeTooltip) {
                    closeTooltip(activeTooltip);
                }
            });
        }
        
        // Loop through all elements that need icons
        Object.keys(tooltipContent).forEach(function(elementId) {
            const element = document.getElementById(elementId);
            if (!element) return; // Skip if element doesn't exist
            
            // Find the label for this element
            let labelElement;
            
            if (elementId === 'equity-type-selection') {
                // Special case for radio buttons
                labelElement = element.querySelector('label');
            } else if (elementId === 'salary-slider') {
                // Special case for slider
                labelElement = element.previousElementSibling;
            } else {
                // Standard input fields
                labelElement = document.querySelector(`label[for="${elementId}"]`);
            }
            
            if (!labelElement) return; // Skip if no label found
            
            // Create the icon container
            const iconContainer = document.createElement('span');
            iconContainer.className = 'info-icon-container';
            iconContainer.setAttribute('data-for', elementId);
            
            // Create the info icon
            const infoIcon = document.createElement('span');
            infoIcon.className = 'info-icon';
            infoIcon.setAttribute('tabindex', '0');
            infoIcon.setAttribute('role', 'button');
            infoIcon.setAttribute('aria-label', `Help for ${labelElement.textContent.trim()}`);
            infoIcon.innerHTML = 'i';
            
            // Create the tooltip
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip';
            tooltip.innerHTML = tooltipContent[elementId];
            tooltip.setAttribute('aria-hidden', 'true');
            
            // Add a close button for mobile
            if (isMobile) {
                const closeButton = document.createElement('button');
                closeButton.textContent = 'âœ•';
                closeButton.className = 'tooltip-close';
                closeButton.setAttribute('aria-label', 'Close tooltip');
                tooltip.appendChild(closeButton);
                
                // Close tooltip when clicking the close button
                closeButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    e.preventDefault();
                    closeTooltip(tooltip);
                });
                
                // Make close button visible on mobile
                closeButton.style.display = 'block';
            }
            
            // Check position to adjust tooltip placement
            const rect = element.getBoundingClientRect();
            const windowWidth = window.innerWidth;
            
            if (!isMobile) {
                if (rect.right > windowWidth * 0.75) {
                    tooltip.classList.add('tooltip-left');
                } else if (rect.left < windowWidth * 0.25) {
                    tooltip.classList.add('tooltip-right');
                }
            }
            
            // Handle tooltip visibility
            if (isMobile) {
                // Mobile: toggle on touch/click
                // Add multiple event types for better mobile support
                ['click', 'touchstart'].forEach(eventType => {
                    infoIcon.addEventListener(eventType, function(e) {
                        e.stopPropagation();
                        e.preventDefault(); // Prevent default touch behavior
                        
                        // Close any other open tooltips
                        if (activeTooltip && activeTooltip !== tooltip) {
                            closeTooltip(activeTooltip);
                        }
                        
                        // Toggle this tooltip
                        if (tooltip.style.visibility === 'visible') {
                            closeTooltip(tooltip);
                        } else {
                            openTooltip(tooltip);
                        }
                    });
                });
                
                // Prevent touch events inside tooltip from closing it
                tooltip.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            } else {
                // Desktop: show on hover
                infoIcon.addEventListener('mouseenter', function() {
                    tooltip.style.visibility = 'visible';
                    tooltip.style.opacity = '1';
                    tooltip.setAttribute('aria-hidden', 'false');
                });
                
                infoIcon.addEventListener('mouseleave', function() {
                    tooltip.style.visibility = 'hidden';
                    tooltip.style.opacity = '0';
                    tooltip.setAttribute('aria-hidden', 'true');
                });
                
                // Keep tooltip visible when hovering over it
                tooltip.addEventListener('mouseenter', function() {
                    tooltip.style.visibility = 'visible';
                    tooltip.style.opacity = '1';
                    tooltip.setAttribute('aria-hidden', 'false');
                });
                
                tooltip.addEventListener('mouseleave', function() {
                    tooltip.style.visibility = 'hidden';
                    tooltip.style.opacity = '0';
                    tooltip.setAttribute('aria-hidden', 'true');
                });
            }
            
            // Keyboard support
            infoIcon.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    
                    if (isMobile) {
                        // Mobile behavior (toggle)
                        if (tooltip.style.visibility === 'visible') {
                            closeTooltip(tooltip);
                        } else {
                            openTooltip(tooltip);
                        }
                    } else {
                        // Desktop behavior (toggle)
                        if (tooltip.style.visibility === 'visible') {
                            tooltip.style.visibility = 'hidden';
                            tooltip.style.opacity = '0';
                            tooltip.setAttribute('aria-hidden', 'true');
                        } else {
                            tooltip.style.visibility = 'visible';
                            tooltip.style.opacity = '1';
                            tooltip.setAttribute('aria-hidden', 'false');
                        }
                    }
                } else if (e.key === 'Escape' && tooltip.style.visibility === 'visible') {
                    closeTooltip(tooltip);
                }
            });
            
            // Lose focus closes tooltip
            infoIcon.addEventListener('blur', function() {
                if (!isMobile) {
                    setTimeout(function() {
                        tooltip.style.visibility = 'hidden';
                        tooltip.style.opacity = '0';
                        tooltip.setAttribute('aria-hidden', 'true');
                    }, 200);
                }
            });
            
            // Assemble and attach to DOM
            iconContainer.appendChild(infoIcon);
            iconContainer.appendChild(tooltip);
            labelElement.appendChild(iconContainer);
        });
        
        // Close tooltips when clicking anywhere else
        if (isMobile) {
            document.addEventListener('click', function(e) {
                if (activeTooltip) {
                    const container = e.target.closest('.info-icon-container');
                    if (!container) {
                        closeTooltip(activeTooltip);
                    }
                }
            });
        }
    }
    
    // Helper function to open tooltip (mobile)
    function openTooltip(tooltip) {
        tooltip.style.visibility = 'visible';
        tooltip.style.opacity = '1';
        tooltip.setAttribute('aria-hidden', 'false');
        
        if (tooltipOverlay) {
            tooltipOverlay.style.display = 'block';
        }
        
        activeTooltip = tooltip;
    }
    
    // Helper function to close tooltip (mobile)
    function closeTooltip(tooltip) {
        tooltip.style.visibility = 'hidden';
        tooltip.style.opacity = '0';
        tooltip.setAttribute('aria-hidden', 'true');
        
        if (tooltipOverlay) {
            tooltipOverlay.style.display = 'none';
        }
        
        activeTooltip = null;
    }
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(addInfoIcons, 300); // Slight delay to ensure all elements are ready
        });
    } else {
        setTimeout(addInfoIcons, 300);
    }
})();
}
